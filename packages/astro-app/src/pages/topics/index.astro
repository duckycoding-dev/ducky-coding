---
import { TopicCard } from '@components/TopicCard';
import { HolyGrailLayout } from '@layouts/HolyGrailLayout';
import { TopicsService } from '@services/db/topics/TopicsService';
import type { ImageGlob } from '@ducky-coding/types';

const topics = await TopicsService.getAll();
// Process topics and match with images
const imagesInSrcTopicsDirectory: ImageGlob[] = await Astro.glob(
  '/src/assets/images/topics/**/*.{jpeg,jpg,png,gif,svg}',
);

const processedTopics = topics.map((topic) => {
  let processedImage: ImageGlob | undefined;
  const imageToFind = topic.imageFilename;
  if (imageToFind) {
    processedImage = imagesInSrcTopicsDirectory.find((img) =>
      img.default.src.includes(imageToFind),
    );
  }
  return {
    ...topic,
    imageSrc: processedImage ? processedImage.default : null,
  };
});
---

{
  /* not sure why I can't just pass a ImageMetaData type to TopicsCard even if I add it as a possible type for src */
}

<HolyGrailLayout
  seoProps={{
    description:
      "Here's a list of all the topics I've written about in my articles: find what you need in a nicely organized way.",
    extend: {
      meta: [
        {
          name: 'keywords',
          content: 'DuckyCoding, web development, topics, articles',
        },
      ],
    },
  }}
>
  <h1 class='pb-8 text-center text-4xl font-extrabold'>Topics</h1>
  <div class='grid-container grid grid-cols-1 gap-5'>
    {
      processedTopics.map((topic) =>
        topic.imageSrc ? (
          <TopicCard
            imageSrc={topic.imageSrc as unknown as string}
            imageAlt={topic.imageAlt ?? `${topic.title} representation`}
            title={topic.title}
            slug={topic.slug}
          />
        ) : (
          <p>Image not found for {topic.title}</p>
        ),
      )
    }
  </div>
</HolyGrailLayout>

<style>
  @media (width >= 500px) {
    .grid-container {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  @media (width >= 768px) {
    .grid-container {
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    }
  }
</style>
