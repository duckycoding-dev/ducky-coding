---
import { HolyGrailLayout } from '@layouts/HolyGrailLayout';
import { TopicsService } from '@services/db/topics/TopicsService';
import { PostCard } from '@components/PostCard';
import { getCollection } from 'astro:content';

// 1. Generate a new path for every collection entry
export async function getStaticPaths() {
  const topics = await TopicsService.getAll();
  return topics.map((topic) => {
    return {
      params: { topic: topic.slug },
      props: { topic },
    };
  });
}
// 2. For your template, you can get the entry directly from the prop
const { topic } = Astro.props;
const postsEntries = await getCollection('posts');
const relatedPosts = postsEntries.filter((entry) => {
  return entry.data.topic.title === topic.title && entry.data.isPublished;
});
---

<HolyGrailLayout
  title={topic.title}
  seoProps={{
    title: `Topic: ${topic.title}`,
    description: `Discover the latest articles related to ${topic.title}, written by DuckyCoding!`,
    extend: {
      meta: [
        {
          name: 'keywords',
          content: `${topic.title}, articles about ${topic.title}, articles, posts`,
        },
      ],
    },
  }}
>
  <h1 class='mb-8 text-center text-4xl font-extrabold'>{topic.title}</h1>
  <ul class='grid-container grid gap-8'>
    {
      relatedPosts.map((post) => {
        return (
          <>
            <li class='mb-8 last-of-type:mb-0'>
              <PostCard post={post} />
            </li>
          </>
        );
      })
    }
  </ul>
</HolyGrailLayout>

<style>
  @media (width >= 768px) {
    .grid-container {
      grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    }
  }
</style>
