---
import { HolyGrailLayout } from '@layouts/HolyGrailLayout';
import { Button } from '@components/Button';
import { GET } from './api/v1/auth/verify-user';
import { Link } from '../components/Link';
import { InputWithLabel } from '../components/Form/InputWithLabel';

export const prerender = false;
const res = await (await GET(Astro)).json();

if (res.user) {
  return Astro.redirect('/');
}
---

<HolyGrailLayout
  title='Sign up'
  seoProps={{
    title: 'Sign up',
    description:
      "Sign up to DuckyCoding's blog: like, save and comment on your favorite content!",
    extend: {
      meta: [
        {
          name: 'keywords',
          content: 'sign up, register, DuckyCoding, web development, auth',
        },
      ],
    },
  }}
>
  <h1 class='mb-8 text-center text-4xl font-extrabold'>Sign up</h1>
  <p class='mb-8 text-center text-lg'>
    Create an account to manage your favorite posts, customize your experience
    and engage with other developers!
  </p>
  <form action='/api/v1/auth/signup' method='post' class='flex flex-col gap-4'>
    <InputWithLabel
      type='email'
      name='email'
      id='email'
      title='Email'
      placeholder='Your email'
      required={true}
    >
      Email
    </InputWithLabel>
    <InputWithLabel
      type='text'
      name='username'
      id='username'
      title='Username'
      placeholder='Your username'
      required={true}
    >
      Username
    </InputWithLabel>
    <InputWithLabel
      type='text'
      name='name'
      id='name'
      title='name'
      placeholder='Your name'
      required={true}
    >
      Name
    </InputWithLabel>
    <InputWithLabel
      type='text'
      name='lastName'
      id='lastName'
      title='Last name'
      placeholder='Your last name'
      required={false}
    >
      Last name
    </InputWithLabel>
    <InputWithLabel
      type='password'
      name='password'
      id='password'
      title='Password'
      placeholder='Your password'
      required={true}
    >
      Password
    </InputWithLabel>
    <InputWithLabel
      type='password'
      name='repeatPassword'
      id='repeatPassword'
      title='Repeat password'
      placeholder='Your password (again)'
      required={true}
    >
      Repeat password
    </InputWithLabel>

    <Button class={'w-full mt-4'} type='submit' variant={'contained'}
      >Sign up</Button
    >
  </form>
  <p class='mt-4 text-sm text-red-500'>* Required fields</p>

  <p class='mt-2 text-center'>
    By signing up, you agree to our
    <Link href='/terms' class={'font-extrabold'}> Terms of Service </Link>
    and
    <Link href='/privacy' class={'font-extrabold'}> Privacy Policy </Link>
  </p>
  <p class='mt-4 text-center'>
    Already have an account?
    <Link href='/login' class={'font-extrabold'}> Login instead! </Link>
  </p>
</HolyGrailLayout>

<style>
  form input:invalid:focus,
  form input:invalid:active {
    outline: 2px solid var(--color-danger);
  }
  form input:valid:focus,
  form input:valid:active {
    outline: 2px solid var(--color-success);
  }
</style>
