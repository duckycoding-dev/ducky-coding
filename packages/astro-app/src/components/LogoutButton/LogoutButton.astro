---
import type { HTMLAttributes } from 'astro/types';
import { Link, type LinkProps } from '../Link';
import { cn } from '../../utils/cn';

export interface LogoutButtonProps extends LinkProps {}

interface Props extends LogoutButtonProps, HTMLAttributes<'a'> {}

const { class: className, ...props }: Props = Astro.props;
---

<Link
  data-astro-prefetch='false'
  id={'logout-button'}
  href={'/api/v1/auth/logout?fromEveryDevice=true'}
  class={cn(
    'text-3xl md:text-base text-primary font-medium w-full hover:text-danger active:text-danger focus:text-danger',
    className,
  )}
  {...props}
>
  Logout
</Link>

<script>
  const logoutButton = document.querySelector('#logout-button');
  logoutButton?.addEventListener('click', (event: Event) => {
    event.preventDefault();
    fetch('/api/v1/auth/logout?fromEveryDevice=true')
      .then((response) => {
        console.log(response);
        if (response.status === 200 || response.status === 403) {
          localStorage.removeItem('user');
          localStorage.removeItem('sessionExpiresAt');
          window.location.href = '/';
        }
      })
      .catch((error) => {
        console.error('Error logging out:', error);
      });
  });
</script>
