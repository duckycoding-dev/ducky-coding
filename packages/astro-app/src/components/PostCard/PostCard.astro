---
import { Image } from 'astro:assets';
import type { CollectionEntry } from 'astro:content';
import type { ImageMetadata } from 'astro';
import type { HTMLAttributes } from 'astro/types';
import DuckyCodingLogo from '@assets/images/DuckyCoding_logo.png';
import { cn } from '@utils/cn';
import { IMAGE_DENSITIES } from '@utils/globals';
import { Card } from '../Card';
import { Link } from '../Link';
import { Tag } from '../Tag';

export interface PostCardProps extends HTMLAttributes<'a'> {
  post: CollectionEntry<'posts'>;
  bannerImage?: ImageMetadata | null;
  loading?: 'eager' | 'lazy';
}

interface Props extends PostCardProps {}

const { props }: { props: Props } = Astro;

const { post, bannerImage, class: className, loading = 'lazy' } = props;
---

<Link variant='unstyled' href={`/posts/${post.slug}`} class={cn(className)}>
  <Card class='card flex h-full flex-col'>
    <Image
      src={bannerImage ?? DuckyCodingLogo}
      width={bannerImage
        ? Math.floor(bannerImage.width / 3)
        : Math.floor(DuckyCodingLogo.width / 3)}
      height={bannerImage
        ? Math.floor(bannerImage.height / 3)
        : Math.floor(DuckyCodingLogo.height / 3)}
      alt={post.data.bannerImage.alt ?? 'Post banner image'}
      densities={IMAGE_DENSITIES}
      loading={loading}
      decoding={'async'}
      class='bg-primary-700 h-48 w-full object-cover'
    />
    <footer
      class='border-secondary flex grow flex-col gap-2 border-t-4 pb-4 pt-2.5'
    >
      <h2 class='px-5 text-2xl font-black'>
        {post.data.title}
      </h2>
      <section>
        <p class='border-secondary px-5 text-base font-semibold'>
          <span
            >Written by: {
              post.data.authors.map((author) => author.username).join(', ')
            }</span
          >
        </p>
        <p class='px-5 text-sm italic'>
          Read time: {post.data.timeToRead}
          {post.data.timeToRead > 1 ? 'minutes' : 'minute'}
        </p>
      </section>
      <section
        class='tags border-secondary mt-auto flex flex-wrap justify-end gap-2 px-5 text-sm font-semibold'
      >
        {
          post.data.tags.map((tag) => (
            <Tag class='odd:bg-accent even:bg-accent2'>{tag}</Tag>
          ))
        }
      </section>
    </footer>
  </Card>
</Link>

<style>
  .card {
    container-name: card;
    container-type: inline-size;
  }
  @container card (width > 400px) {
    .tags {
      @apply text-xl;
    }
  }
</style>
